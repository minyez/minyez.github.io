---
author: Min-Ye Zhang
bibliography:
- etc/bibliography.bib
categories: tool
comment: false
date: "2024-07-21 11:50:20 +0200"
description: Finally make it possible and I can write org-mode for
  Jekyll.
math: true
tags: Emacs org-mode pandoc ox-pandoc
title: Generate Markdown from org-mode file using ox-pandoc
---

## Background

This blog site is generated by Jekyll and rendered beautifully using the
[Chirpy](https://github.com/cotes2020/jekyll-theme-chirpy) theme. I'm
pretty happy with it, but I feel sometimes rather hesitant, to add more
posts. I did not have this feeling years ago when I only use markdown to
write posts.

It comes from the fear of repeating myself: I am writing all my private
notes in [org-mode](https://orgmode.org/). This format is powered by
Emacs and have rich features in addition to markdown. On the other hand,
while Jekyll can recognize org-mode with the help of
[`jekyll-org`](https://github.com/eggcaker/jekyll-org), markdown is
still its favorite format. Before finding a good exporter, I have to
copy the file, manually do the conversion from org-mode to markdown, and
repeat it whenever I update the original note. This is a boring labor
and does not add to my knowledge.

This fear, if not the underlying laziness[^1], has been holding me from
publishing more posts here. Now, eventually, I find myself unable to
stand it any more and face it directly.

## In the market

I am definitely not the only one with this problem. Searching the
Internet gives me a few available approaches:

1.  `ox-md`: built-in markdown exporter. With a quick try, I found that
    it failed to export the `#+title` property correctly. It does not
    write ```` ``` ```` style code block either, making the syntax
    highlighter in Jekyll useless.
2.  `ox-gfm`: exporter for GitHub favored markdown, derived from
    `ox-md`. It can correctly export ```` ``` ```` code block, but still
    fails to export the title.
3.  `ox-html`: also a built-in exporter but directly to HTML. This is a
    fundamental way to publish org-mode contents online, and has been
    used to connect org-mode and Jekyll as described in [this official
    tutorial](https://orgmode.org/worg/org-tutorials/org-jekyll.html)).
    However, it seems rather cumbersome to take advantage of the Chirpy
    theme when posts are directly written in HTML.
4.  `ox-hugo`: a markdown exporter oriented to the Hugo system. This
    exporter is oriented to Hugo, and it assumes the file hierarchy in
    Hugo. For example, markdown posts have to be exported under the
    `content` directory.
5.  `ox-pandoc`: wrapper around the wonderful universal converter
    [pandoc](https://pandoc.org). It correctly handles title and code
    blocks when exporting markdown. It also respects `export_file_name`
    so that I can specify any location for the exported file.

`ox-pandoc` turns out to suit the best for my purpose.

## Configuration

To use `ox-pandoc`, `pandoc` should of course be discoverable in the
executable paths, and then include `ox-pandoc` in Emacs configuration.
The latter is almost one-liner in Doom Emacs: simply switching on the
pandoc plugin of the org module in `init.el`

``` elisp
(doom! :lang
       (org +pandoc))
```

Decent defaults have already been configured, so it is not necessary to
add more codes to `config.el`. If bibliography is needed, `citeproc-el`
package should be installed and loaded.

``` elisp
;; in package.el
(package! citeproc)

;; in config.el
(use-package! citeproc)
```

## File setup

### Raise level of headings

Heading level of markdown posts in Jekyll starts from 2, but it usually
starts from 1 in org-mode. Therefore the heading level should be
promoted by 1 when exporting to markdown for Jekyll. There is exactly a
variable for this purpose in the built-in markdown exporter
`org-md-toplevel-hlevel` (also `org-html-toplevel-hlevel` in HTML
exporter). Unfortunately, `ox-pandoc` does not recognize this variable.
Instead, the `--shift-heading-level-by` command line option of pandoc
should be used. This can be set per file

    #+PANDOC_OPTIONS: shift-heading-level-by:1

### Metadata

Metadata, such as category and tags, have to be parsed to pandoc by
`#+PANDOC_METADATA` option. Different entries can be specified in
multiple `#+PANDOC_METADATA` lines.

    #+PANDOC_METADATA: categories:tool
    #+PANDOC_METADATA: "tags:Emacs org-mode pandoc ox-pandoc"

This is already handy, though it would be nice if `ox-pandoc` can
recognize `#+filetags`.

### Liquid template

Simple liquid filter can be used by wrapping it with markdown raw code,
`@@markdown:@@`. For example,
`@@markdown:site.time | date_to_xmlschema@@` (double curl brace
neglected, otherwise it will be rendered as liquid) gives:
{{ site.time | date_to_xmlschema }}.

### Internal links

Direct internal link such as `[[Internal links]]` works in org-mode, but
would be exported to something like `[4.4](#Internal links)` by
`ox-pandoc` at the time of writing. A workaround is to use the explicit
anchor `[[#internal-links][Internal links]]`, leading to [Internal
links](#internal-links). To make it also work within org-mode, a custom
id is required

    ** Internal links
    :PROPERTIES:
    :CUSTOM_ID: internal-links
    :END:

### Equations

Typing equations is simple. In org-mode it is not required to add
surrounding `$$` for a display math equation.

``` latex
\begin{equation}\label{eq:euler}
\begin{aligned}
e^{i \pi} + 1 = 0
\end{aligned}
\end{equation}
```

which is rendered as

$$\begin{equation}\label{eq:euler}
\begin{aligned}
e^{i \pi} + 1 = 0
\end{aligned}
\end{equation}$$

It is possible in org-mode to cross-reference the equation by
`eqref:eq:euler` using [org-ref](https://github.com/jkitchin/org-ref).
Unfortunately it is neither acknowledged by markdown nor converted to
the correct `$\eqref{eq:euler}$` syntax (a pandoc filter may do the
work). So one still need to explicitly use `$\eqref{eq:euler}$`
(rendered as $\eqref{eq:euler}$) to refer to the equation.

### Citation and Bibliography

`ox-pandoc` is aware of org-cite-style citation link, for example,
`[cite:@PerdewJ96PBE]`, and can render it into markdown-type link before
it is parsed to pandoc using
[citeproc-el](https://github.com/andras-simonyi/citeproc-el). One just
needs to specify the bibliography file to look for the citation key with
`#+bibliography` and how the entry should be exported with
`#+cite_export`; see [this
section](https://github.com/emacsorphanage/ox-pandoc?tab=readme-ov-file#citations-and-bibliographies-experimental)
of `ox-pandoc`.

In my case, I have a `.bib` file and citation style file under `etc/`
directory, so I just need to add the following two lines in the heading

    #+bibliography: etc/bibliography.bib
    #+cite_export: csl etc/american-physics-society-without-titles.csl

When exported to markdown, `[cite:@PerdewJ96PBE]` is rendered as
`\[[1](#citeproc_bib_item_1)\]` and gives Â \[[1](#citeproc_bib_item_1)\]
on the Jekyll end. To print the bibliography, just insert the directive
`#+print_bibliography:` at the place where you want to put the list of
references. In this case, it is converted to markdown as

``` markdown
<span id="citeproc_bib_item_1"></span>\[1\] J. P. Perdew, K. Burke, and
M. Ernzerhof, Phys. Rev. Lett. **77**, 3865 (1996).
```

## Summary

With `pandoc` and `ox-pandoc` in Emacs, I can write my org-mode notes,
convert them to markdown and finally publish them on my Jekyll site,
without laborious manual changes. In fact, this post is written in this
way.

## References

<span id="citeproc_bib_item_1"></span>\[1\] J. P. Perdew, K. Burke, and
M. Ernzerhof, Phys. Rev. Lett. **77**, 3865 (1996).

------------------------------------------------------------------------

[^1]: [Laziness is actually a fear of trouble and
    fatigue.](https://quod.lib.umich.edu/e/ecco/004892937.0001.001/1:7.180?rgn=div2;view=fulltext)
